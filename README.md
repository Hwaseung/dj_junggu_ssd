# *빵해장* README.md 개요
- 해당  파일에서는 *빵해장* 팀이 제출한 파일에 대해 설명할 예정이다. 아래 목차는 본 팀이 분석한 과정을 순서대로 나열한 결과이다.  
- 색인 순서 : [1. ~ 4.] > [1-1 ~ 4-4] > [(1) ~ (10)] > [① ~ ②]


# 목차
[1. notebooks.ipynb](#1-notebooks.ipynb)  
[2. 이동경로 및 소비패턴 파일_컬럼 정의서.xlsx](#2-이동경로-및-소비패턴-파일_컬럼-정의서.xlsx)  
[3. 기획안.pdf](#3-기획안.pdf)  
[4. figures](#4-figures)  


# 1. notebooks.ipynb
해당 파일의 색인 순서와 동일하게 작성
## 0 data & packages
### 0-0 코드를 돌린 환경에 대해 정의
(1) 컴퓨터 환경  
(2) CPU 코어 수  
(3) 주피터 노트북 버전  
(4) 파이썬 버전

### 0-1 패키지를 설치 & 불러오기
(1) 패키지 설치  
- holidays : 공휴일에 대한 정보를 담고 있는 패키지
- pyproj : 지리 좌표계 변환을 수행하는 패키지
- numba : Python 코드에서 빠른 속도의 JIT(Just-In-Time) 컴파일을 제공하여 수치 연산을 최적화하는 패키지
- geopy : 지리적 좌표의 변환, 거리 계산, 및 지오코딩(주소 ↔ 좌표)을 지원하는 Python 라이브러리
- joblib : 병렬 처리와 객체 직렬화(저장 및 로드)를 효율적으로 지원하는 Python 라이브러리

</br>

(2) 패키지 불러오기
- 파이썬에 내장되어있는 패키지 로드
- 앞서 (1)에서 설치한 패키지 로드

</br>

(3) **path에 데이터를 불러오고, 저장할 경로 지정**
  
### 0-2 제공된 데이터, 외부 데이터 등 사용된 데이터 불러오기
(1) 제공된 데이터 - main
- 제공된 데이터 중 주요한 데이터
  - 유동인구
  - 카드매출 (cell id별)
  - 카드매출 (지역별 업종 유입고객)

- 데이터명은 아래와 같이 간소화하여 사용
  - 유동인구 → 유동인구
  - 카드매출 (cell id별) → 카드매출_가맹점
  - 카드매출 (지역별 업종 유입고객) → 카드매출_유입고객  
  
→ 제공된 데이터는 모두 1개월 단위씩 나눠져있기 때문에 이를 한 데이터로 합치기  

</br>

(2) 제공된 데이터 - sub
- 제공된 데이터 중 (1)의 main data를 보조하는 데이터
  - 국토지리정보원_국토조사_(격자)500M.csv
  - 상가(상권)정보_업종분류.xlsx
 
</br>

(3) 외부 데이터
- 행정동 코드 : 행정동 코드에 맞는 행정동명 찾을 때 활용
  - *행정안정부 > 행정기관(행정동) 및 관할구역(법정동) 변경내역(2024.8.1. 시행)* 의 ***KIKcd_H.20240801.xlsx*** 활용
  - 출처 : https://www.mois.go.kr/frt/bbs/type001/commonSelectBoardArticle.do?bbsId=BBSMSTR_000000000052&nttId=111209 
- 한국표준산업분류10차 : 업종 분류 코드에 맞는 항목명 찾을 때 활용
  - *카드매출_컬럼정의서* 에 나와있는 것처럼 ***통계청 한국표준산업분류10차*** 를 사용
  - 출처 : http://ecosmart.kaist.ac.kr/bbs/board.php?bo_table=menu3_1&wr_id=1 



## 1 데이터 전처리
### 1-1 유동인구
#### (1) id
#### (2) 행정동 코드
##### 행정동명 컬럼 추가 : 외부데이터 > *KIKcd_H.20240801.xlsx* 활용
- *유동인구 > admi_cd* 는 숫자형으로 되어있어 어떤 행정동인지 직관적으로 알아보기가 쉽지 않다.
- 따라서 행정동 코드와 그에 해당하는 행정동명 데이터인 *KIKcd_H.20240801.xlsx* 를 활용하여 *유동인구 > admi_cd*에 맵핑한다.

#### (3) x, y 좌표
- KT에서 사용한 KATECH 좌표를 경위도로 변환
- pyproj > Proj, Transformer 사용
- 다음과 같은 << x, y → 경위도 >> 변환 함수를 정의
  ```
  katech_proj = Proj(
      "+proj=tmerc +lat_0=38 +lon_0=128 +k=0.9999 +x_0=400000 +y_0=600000 +ellps=bessel "
      "+towgs84=-115.80,474.99,674.11,1.16,-2.31,-1.63,6.43 +units=m +no_defs"
  )
  
  # Define the WGS84 projection
  wgs84_proj = Proj(proj="latlong", datum="WGS84")
  
  # Create a Transformer object for the conversion
  transformer = Transformer.from_proj(katech_proj, wgs84_proj)
  
  # Function to convert from KATECH (TM127) to WGS84
  def katech_to_wgs84(x, y):
      lon, lat = transformer.transform(x, y)
      return lat, lon
  ```

#### (4) 필요없는 컬럼 삭제
- 'x', 'y' : 경위도로 변환 완료 (latitude, longitude로 대체)
- 'admi_cd' : 행정동명 컬럼 추가 완료 (행정동명으로 대체)
- 'total' : 연령대별 이동경로 및 소비패턴을 살펴볼 예정이므로 삭제

  
#### (5) holiday & weekend 컬럼 추가
1. **holiday** : 국가에서 지정한 공휴일
   - holidays 패키지 활용
   - 공휴일 아님 / 공휴일
2. **weekend** : *etl_ymd* 에서 파생. 토요일, 일요일
   - 평일 / 주말
 

#### (6) 연령대별 컬럼 합치기 : 10세 단위로
- m00, f00 : 10세 미만
- m00 ~ m10, f00 ~ f10 : 10대
- m20 ~ m25, f20 ~ f25 : 20대
- m30 ~ m35, f30 ~ f35 : 30대
- m40 ~ m45, f40 ~ f45 : 40대
- m50 ~ m55, f50 ~ f55 : 50대
- m60 ~ m65, f60 ~ f65 : 60대
- m70, f70 : 70대 이상


### 1-2 카드매출_가맹점
#### (1) cell_id : 경위도 컬럼 추가
- 500m*500m 셀의 위치를 나타내는 컬럼
- 함께 주어진 ***국토지리정보원_국토조사_(격자)500M.csv***를 활용하여 경도/위도로 변환
##### ① *국토지리정보원_국토조사_(격자)500M.csv*
- x좌표, y좌표 : UTM-K 좌표 → 경위도 좌표(wsg84)로 변환  
- 이때, EPSG는 중앙 경선이 127도가 되도록 하는 **대한민국 중앙부 기준** 사용
```
transformer = Transformer.from_crs("epsg:5178", "epsg:4326", always_xy=True)

# 위도와 경도로 변환하는 함수
def katec_to_wgs84(x, y):
    lon, lat = transformer.transform(x, y)
    return lon, lat

# 새로운 열을 추가
data_loc['longitude'], data_loc['latitude'] = zip(*data_loc.apply(lambda row: katec_to_wgs84(row['x좌표'], row['y좌표']), axis=1))
```
##### ② *카드매출_가맹점 > cell_id* 에 맵핑
- *카드매출_가맹점 > cell_id* 종류는 다음과 같음
  >  '다바88b09b', '다바88b10a', '다바89a09b', '다바89a10a', '다바89a10b',
       '다바89a11b', '다바89b09b', '다바89b10b', '다바89b11a', '다바89b11b',
       '다바89b12a', '다바89b12b', '다바89b13a', '다바89b13b', '다바90a10b',
       '다바90a11a', '다바90a11b', '다바90a12a', '다바90a12b', '다바90a13a',
       '다바90a13b', '다바90a14a', '다바90a14b', '다바90b08a', '다바90b08b',
       '다바90b10b', '다바90b11a', '다바90b12a', '다바90b12b', '다바90b13a',
       '다바90b13b', '다바90b14a', '다바90b14b', '다바90b15a', '다바91a11b',
       '다바91a12a', '다바91a12b', '다바91a13a', '다바91a13b', '다바91a14a',
       '다바91a14b', '다바91a15a', '다바91a15b', '다바91a16b', '다바91b11a',
       '다바91b12a', '다바91b12b', '다바91b13a', '다바91b13b', '다바91b14a',
       '다바91b14b', '다바91b15a', '다바91b15b', '다바91b16a', '다바91b16b',
       '다바92a12a', '다바92a12b', '다바92a13a', '다바92a13b', '다바92a14a',
       '다바92a14b', '다바92a15a', '다바92a15b', '다바92a16a', '다바92b04a',
       '다바92b12a', '다바92b12b', '다바92b13a', '다바92b13b', '다바92b14a',
       '다바92b14b', '다바92b15a', '다바92b15b', '다바93a12a', '다바93a12b',
       '다바93a13a', '다바93a13b', '다바93a14a', '다바93a14b', '다바93a15a',
       '다바93b12a', '다바93b12b', '다바93b13a', '다바93b13b', '다바93b14a',
       '다바93b14b', '다바94a12b', '다바94a13a', '다바94a13b', '다바94a14a',
       '다바94b12a', '다바94b12b', '다바94b13a', '다바95a11b', '다바95a12a',
       '다바95b11a', '다바95b11b', '다바96a11a', '다바90a08a', '다바91a10b',
       '다바88b09a', '다바94a12a', '다바95b10b', '다바90b11b', '다바91b08b',
       '다바94b11a', '다바95a11a', '다바91a08b', '다바92b02b', '다바91a16a',
       '다바91b05b', '다바89b08a', '다바91a08a', '다바92a02a', '다바94b11b',
       '다바92a01b', '다바89a11a', '다바91b11b', '다바89a09a', '다바90a07b',
       '다바92b01b', '다바95a12b', '다바91a05a', '다바94a11b', '다바92b09b',
       '다바90b09a', '다바96a10b', '다바90a08b', '다바93a05a'
- *국토지리정보원_국토조사_(격자)500M*에서 '다바'를 포함하고 있는 cell_id 찾아서 *카드매출_가맹점 > cell_id*에 위도, 경도 맵핑

#### (2) 업종대분류, 업종중분류, 업종소분류
##### ① 결측치 : drop
- ***카드매출_가맹점* 을 통해서 *업종소분류*를 파악하는 것이 중요하기 때문에 업종소분류가 결측치인 데이터는 모두 제외**
- *업종소분류*의 결측치를 제거하면 *업종대분류, 업종중분류*의 결측치도 다함께 제거됨
- 따라서 *업종소분류*의 결측치를 제거하면 *업종대분류, 업종중분류, 업종소분류*의 결측치가 모두 0이 됨

##### ②업종분류명 컬럼 추가
###### **방법[1]** ***상가(상권)정보_업종분류.xlsx***
- 제공된 데이터 - sub 중 업종분류코드별 업종분류명이 표기돼 있는 데이터
- 그런데 해당 데이터는 ***카드매출_가맹점***에 있는 모든 업종분류코드를 설명하고 있지 않다.
```
카드매출_가맹점 > 업종대분류
 ['G' 'I' 'M' 'S' 'P' 'O' 'R' 'N' 'C' 'Q' 'H' 'J' 'K' 'L']

상가(상권)정보_업종분류 > 대분류코드
 ['G2' 'I1' 'I2' 'L1' 'M1' 'N1' 'P1' 'Q1' 'R1' 'S2']
```
- *상가(상권)정보_업종분류* 는 *카드매출_가맹점* 의 모든 업종분류를 포함하고 있지 않음  
- 따라서 업종분류명 컬럼을 추가할 때는 다음 방법[2]를 사용

</br>

###### **방법[2]** ***한국표준산업분류10차_표.xlsx***
- 외부 데이터인 ***통계청 한국표준산업분류10차***(한국표준산업분류10차_표.xlsx) 활용
- *한국표준산업분류10차_표.xlsx* 컬럼(왼쪽)과 *카드매출_가맹점 > 업종대분류, 업종중분류, 업종소분류*(오른쪽) 비교
  - **대분류(21) : 업종대분류**
  - **중분류(77) : 업종중분류**
  - 소분류(232) : (대응되는 컬럼 없음)
  - 세분류(495) : (대응되는 컬럼 없음)
  - **세세분류(1,196) : 업종소분류**
- *한국표준산업분류10차_표.xlsx > 소분류(232), 세분류(495)* 는 *카드매출_가맹점* 컬럼에 대응되지 않기 때문에 삭제
- 이외 데이터는 다음과 같이 컬럼명 변경
```
[변경 전]
'코드', '항목명', '코드.1', '항목명.1', '코드.4', '항목명.4'

[변경 후]
'대분류_코드', '대분류_항목명','중분류_코드', '중분류_항목명', '소분류_코드', '소분류_항목명'
```

- 대/중/소분류를 각각 {코드 : 항목명} 딕셔너리로 구성  
  e.g. {대분류_코드 : 대분류_항목명}
  ```
  {'A': '농업, 임업 및 어업(01~03)',
   'B': '광업(05~08)',
   'C': '제조업(10~34)',
   'D': '전기, 가스, 증기 및 공기 조절 공급업(35)',
   'E': '수도, 하수 및 폐기물 처리, 원료 재생업(36~39)',
   'F': '건설업(41~42)',
   'G': '도매 및 소매업(45~47)',
   'H': '운수 및 창고업(49~52)',
   'I': '숙박 및 음식점업(55~56)',
   'J': '정보통신업(58~63)',
   'K': '금융 및 보험업(64~66)',
   'L': '부동산업(68)',
   'M': '전문, 과학 및 기술 서비스업(70~73)',
   'N': '사업시설 관리, 사업 지원 및 임대 서비스업(74~76)',
   'O': '공공 행정, 국방 및 사회보장 행정(84)',
   'P': '교육 서비스업(85)',
   'Q': '보건업 및 사회복지 서비스업(86~87)',
   'R': '예술, 스포츠 및 여가관련 서비스업(90~91)',
   'S': '협회 및 단체, 수리 및 기타 개인 서비스업(94~96)',
   'T': '가구 내 고용활동 및 달리 분류되지 않은 자가 소비 생산활동(97~98)',
   'U': '국제 및 외국기관(99)'}
  ```
- ***카드매출_가맹점 > 소분류_코드*는 수치형**인 것에 반해, *카드매출_가맹점 > 업종소분류*는 ***업종대분류*의 문자가 맨 앞에 붙어서 문자형**으로 처리된다.
  이후 분석 시 문자형보다는 수치형이 좋기 때문에 *카드매출_가맹점 > 업종소분류* 맨앞에 붙어있는 알파벳을 제거한다. 숫자도 고유한 값이기 때문에 알파벳을 제거해도 무관하다.  
  ```
  e.g. G47212 → 47212
  ```
- 위에서 정의된 딕셔너리를 *카드매출_가맹점*


# 2. 이동경로 및 소비패턴 파일_컬럼 정의서.xlsx

# 3. 기획안.pdf

## 4. figures

